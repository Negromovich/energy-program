<!DOCTYPE html>
<html lang="ru" ng-app="energy">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Energy</title>

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/app.css" rel="stylesheet">
</head>
<body>

<script src="js/libs/jquery-2.1.0.min.js"></script>
<script src="js/libs/bootstrap.min.js"></script>
<script src="js/libs/angular.min.js"></script>
<script src="js/libs/angular-route.min.js"></script>

<!--<script src="js/app.js"></script>-->
<!--<script src="js/services.js"></script>-->
<!--<script src="js/controllers.js"></script>-->
<!--<script src="js/filters.js"></script>-->
<!--<script src="js/directives.js"></script>-->
<script src="js/libs/math.js"></script>
<script>var math = mathjs();</script>
<script src="js/add/functions.js"></script>

<!--<button id="start">START</button>-->
<div id="calc"></div>

<script>
    var math = mathjs();
    $(function(){
//        $('#start').on('click', function(){
            energy.calc();
//        });
    });
    function print(value) {
        consoleMatrix(value);
        $('#calc').append(renderMatrix(value));
    }
    function calcNetwork() {
return;
        var valueUnom = 10,
            valueUbal = valueUnom * 1.00,
            valuePdiffMax = 0.00000001;

        var defMatrixM = [
            [-1,0,0,1,1,0,0,1,0,0,0],
            [0,-1,0,0,0,1,0,-1,1,0,0],
            [0,0,-1,0,0,0,1,0,0,0,0],
            [0,0,0,-1,0,0,0,0,0,1,0],
            [0,0,0,0,-1,0,0,0,-1,-1,1],
            [0,0,0,0,0,-1,0,0,0,0,-1],
            [0,0,0,0,0,0,-1,0,0,0,0],
//            [1,1,1,0,0,0,0,0,0,0,0]
        ];
        var defMatrixP = [0,0,31.05,0,-33.75,-37.8,-39.15];
        var defMatrixZ = [22.4,19.2,17.6,16,14.4,12.8,11.2,9.6,8,6.4,9.6];

//        defMatrixP = [
//            [0,0,31.05,0,-33.75,-37.8,-39.15],
//            [0,0,31.05,0,-33.75,-37.8,-39.15]
//        ];

        var defMatrixM = energy.createMatricM();
        var defMatrixP = energy.calcPowers(0.120, valueUbal);
        var defMatrixZ = energy.getResists();

        var matrixM = math.matrix(defMatrixM);
//        var matrixMa = matrixMalpha(matrixM);
        var matrixMa = math.subset(matrixM, math.index([0, matrixM.size()[0]], [0, matrixM.size()[0]]));
        var matrixP = math.matrix(defMatrixP);
//        matrixP = math.multiply(matrixP, 0.1);

        var valuePdiff = valuePdiffMax + 1;

        var matrixZv = math.diag(defMatrixZ);
        var matrixYv = math.inv(matrixZv);
        var matrixYy = math.multiply(math.multiply(matrixM, matrixYv), math.transpose(matrixM));

        for (var i = 0; valuePdiff > valuePdiffMax && i < 100; i++) {
            if (matrixUy === undefined) {
                var matrixIy = math.divide(matrixP, valueUnom);
            } else {
//                matrixP = useSHN(matrixP, matrixUy, valueUnom);
                var matrixIy = DivideMatrix(matrixP, matrixUy);
            }
            var matrixUyd = math.multiply(math.inv(matrixYy), matrixIy);
            var matrixUy = math.add(matrixUyd, valueUbal);
            var matrixUvd = math.multiply(math.transpose(matrixM), matrixUyd);
            var matrixIv = math.multiply(math.inv(matrixZv), matrixUvd);

            var matrixIyc = math.multiply(matrixM, matrixIv);
            var matrixPc = math.multiply(math.diag(matrixUy), matrixIyc);
            var matrixPdiff = math.add(matrixP, math.unary(matrixPc));
            valuePdiff = math.max(math.abs(DivideMatrix(matrixPdiff, matrixP)));
            console.log(i, valuePdiff, matrixUy.toArray());
        }

//        print(matrixUyd);
        print(math.multiply(matrixUyd, 100 / valueUbal));

    }
</script>
<script src="js/energy.js"></script>

</body>
</html>
